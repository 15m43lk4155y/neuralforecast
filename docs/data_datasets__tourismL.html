---

title: TourismLarge dataset.


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/data_datasets__tourismL.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/data_datasets__tourismL.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name="cell-1"></a></p>
<h2 id="1.-Auxiliary-Functions">1. Auxiliary Functions<a class="anchor-link" href="#1.-Auxiliary-Functions"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CodeTimer" class="doc_header"><code>class</code> <code>CodeTimer</code><a href="https://github.com/Nixtla/neuralforecast/tree/main/neuralforecast/data/datasets/tourismL.py#L26" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CodeTimer</code>(<strong><code>name</code></strong>=<em><code>None</code></em>, <strong><code>verbose</code></strong>=<em><code>True</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="one_hot_encoding" class="doc_header"><code>one_hot_encoding</code><a href="https://github.com/Nixtla/neuralforecast/tree/main/neuralforecast/data/datasets/tourismL.py#L41" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>one_hot_encoding</code>(<strong><code>df</code></strong>, <strong><code>index_col</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="nonzero_indexes_by_row" class="doc_header"><code>nonzero_indexes_by_row</code><a href="https://github.com/Nixtla/neuralforecast/tree/main/neuralforecast/data/datasets/tourismL.py#L53" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>nonzero_indexes_by_row</code>(<strong><code>M</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name="cell-2"></a></p>
<h2 id="2.-TourismL-Class">2. TourismL Class<a class="anchor-link" href="#2.-TourismL-Class"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TourismL" class="doc_header"><code>class</code> <code>TourismL</code><a href="https://github.com/Nixtla/neuralforecast/tree/main/neuralforecast/data/datasets/tourismL.py#L58" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TourismL</code>(<strong><code>S</code></strong>:<code>DataFrame</code>, <strong><code>X</code></strong>:<code>DataFrame</code>, <strong><code>Y</code></strong>:<code>DataFrame</code>, <strong><code>idx_categorical_static</code></strong>:<code>Optional</code>[<code>List</code>[<code>T</code>]]=<em><code>None</code></em>, <strong><code>group</code></strong>:<code>Union</code>[<code>str</code>, <code>List</code>[<code>str</code>]]=<em><code>None</code></em>) :: <a href="/neuralforecast/data_datasets__utils.html#TimeSeriesDataclass"><code>TimeSeriesDataclass</code></a></p>
</blockquote>
<p>TourismL(S: pandas.core.frame.DataFrame, X: pandas.core.frame.DataFrame, Y: pandas.core.frame.DataFrame, idx_categorical_static: Union[List, NoneType] = None, group: Union[str, List[str]] = None)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name="cell-3"></a></p>
<h2 id="3.-TourismL-Validation">3. TourismL Validation<a class="anchor-link" href="#3.-TourismL-Validation"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="3.1-Load-and-Process-data">3.1 Load and Process data<a class="anchor-link" href="#3.1-Load-and-Process-data"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">directory</span> <span class="o">=</span> <span class="s1">&#39;./data/hierarchical/TourismL&#39;</span>

<span class="n">TourismL</span><span class="o">.</span><span class="n">preprocess_data</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">TourismL</span><span class="o">.</span><span class="n">load_process</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="3.2-Validate-data-with-plots.">3.2 Validate data with plots.<a class="anchor-link" href="#3.2-Validate-data-with-plots."> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Checking-Hierarchical-aggregation-matrix">Checking Hierarchical aggregation matrix<a class="anchor-link" href="#Checking-Hierarchical-aggregation-matrix"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">spy</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Checking-pre-estimated-levels-seasons-S_bottom">Checking pre-estimated levels seasons S_bottom<a class="anchor-link" href="#Checking-pre-estimated-levels-seasons-S_bottom"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dates</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">]</span>
<span class="n">scols_bottom</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;scols&#39;</span><span class="p">]</span>

<span class="c1"># n_groups,n_series,n_features,n_time</span>
<span class="n">Y_bottom</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">228</span><span class="p">)</span>
<span class="n">X_bottom</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span>
<span class="n">X_bottom</span> <span class="o">=</span> <span class="n">X_bottom</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_bottom</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">241</span><span class="p">)</span>
<span class="n">S_bottom</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;data[&#39;scols&#39;]:=&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;scols&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;data[&#39;xcols&#39;]:=&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;xcols&#39;</span><span class="p">])</span>

<span class="n">b_idx</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">[:</span><span class="mi">228</span><span class="p">],</span><span class="n">Y_bottom</span><span class="p">[</span><span class="n">b_idx</span><span class="p">,:],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;signal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">S_bottom</span><span class="p">[</span><span class="n">b_idx</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> 
            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">S_bottom</span><span class="p">[</span><span class="n">b_idx</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">S_bottom</span><span class="p">[</span><span class="n">b_idx</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> 
            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;level_[december]&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">S_bottom</span><span class="p">[</span><span class="n">b_idx</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">S_bottom</span><span class="p">[</span><span class="n">b_idx</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;level_[january]&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> Visits&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;unique_ids&quot;</span><span class="p">][</span><span class="n">b_idx</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Tourism Visits&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> 
           <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span><span class="n">X_bottom</span><span class="p">[</span><span class="n">b_idx</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;signal&#39;</span><span class="p">)</span> <span class="c1"># &#39;y_[lag12]&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span><span class="n">X_bottom</span><span class="p">[</span><span class="n">b_idx</span><span class="p">,</span><span class="mi">4</span><span class="p">,:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;y_[lag12]&#39;</span><span class="p">)</span> <span class="c1"># &#39;y_[lag12]&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span><span class="n">X_bottom</span><span class="p">[</span><span class="n">b_idx</span><span class="p">,</span><span class="mi">0</span><span class="p">,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">2000</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;month_[11]&#39;</span><span class="p">)</span> <span class="c1"># &#39;month_[11]&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> Visits&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;unique_ids&quot;</span><span class="p">][</span><span class="n">b_idx</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Tourism Visits&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> 
           <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c1"># assert 1&lt;0</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;data[&#39;scols_agg&#39;]:=&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;scols_agg&#39;</span><span class="p">][:</span><span class="mi">4</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;data[&#39;xcols_agg&#39;]:=&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;xcols_agg&#39;</span><span class="p">])</span>

<span class="n">X_agg</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;X_agg&#39;</span><span class="p">]</span>

<span class="n">a_idx</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span><span class="n">X_agg</span><span class="p">[</span><span class="n">a_idx</span><span class="p">,</span><span class="mi">1</span><span class="p">,:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;y_[total]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span><span class="n">X_agg</span><span class="p">[</span><span class="n">a_idx</span><span class="p">,</span><span class="mi">2</span><span class="p">,:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;y_[state]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span><span class="n">X_agg</span><span class="p">[</span><span class="n">a_idx</span><span class="p">,</span><span class="mi">3</span><span class="p">,:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;y_[zone]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span><span class="n">X_agg</span><span class="p">[</span><span class="n">a_idx</span><span class="p">,</span><span class="mi">4</span><span class="p">,:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;y_[region]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span><span class="n">X_agg</span><span class="p">[</span><span class="n">a_idx</span><span class="p">,</span><span class="mi">0</span><span class="p">,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">20_000</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;distance_month&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">spy</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;S_agg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Checking-Hierarchically-linked-data">Checking Hierarchically linked data<a class="anchor-link" href="#Checking-Hierarchically-linked-data"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">plot_hierarchically_linked_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b_idx</span><span class="p">,</span> <span class="n">n_years</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">plot_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    
    <span class="c1"># This plots validate the S/X/Y_bottom</span>
    <span class="c1"># We check for the sinchronization of features with Y_bottom</span>
    <span class="c1"># We do the same for Y_agg, to check correct linkage</span>
    <span class="k">assert</span> <span class="n">b_idx</span> <span class="o">&lt;</span> <span class="mi">304</span> <span class="ow">and</span> <span class="n">b_idx</span><span class="o">&gt;=</span><span class="mi">0</span>
    
    <span class="c1"># Hierarchically linked target data and labels</span>
    <span class="c1"># [Total, State, Zone, Region, TotalP, StateP, ZoneP] [0, 1, 2, 3, 4, 5, 6]</span>
    <span class="c1"># [Total, State, Zone, Region] &lt;--&gt; [0, 1, 2, 3]</span>
    <span class="n">linked_idxs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;hier_linked_idxs&#39;</span><span class="p">][</span><span class="n">b_idx</span><span class="p">][:</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">Y_hier</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y_hier&#39;</span><span class="p">]</span>
    <span class="n">hier_labels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;hier_labels&#39;</span><span class="p">]</span>
    
    <span class="c1"># Base series and its label  n_agg=251 idx \in {0,...,304}</span>
    <span class="n">Y_base</span>  <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y_hier&#39;</span><span class="p">][</span><span class="n">b_idx</span> <span class="o">+</span> <span class="mi">251</span><span class="p">]</span>
    <span class="n">Y_base2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">][</span><span class="n">b_idx</span><span class="o">//</span><span class="mi">4</span><span class="p">,</span><span class="n">b_idx</span> <span class="o">%</span> <span class="mi">4</span><span class="p">,:]</span>
    <span class="n">label</span>   <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;hier_labels&#39;</span><span class="p">][</span><span class="n">b_idx</span> <span class="o">+</span> <span class="mi">251</span><span class="p">]</span>
    
    <span class="n">x_plot</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">12</span><span class="p">]</span> <span class="c1"># Skip future dates</span>
        
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">linked_idxs</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">linked_idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">linked_idxs</span><span class="p">):</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="p">[</span><span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">n_years</span><span class="p">:],</span> <span class="n">Y_hier</span><span class="p">[</span><span class="n">linked_idx</span><span class="p">,</span><span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">n_years</span><span class="p">:]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span>
                      <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">hier_labels</span><span class="p">[</span><span class="n">linked_idx</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">Tourist Visits</span><span class="se">\n</span><span class="s1"> [In millions]&#39;</span><span class="p">,</span> 
                            <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    
    <span class="c1"># Checking that Y_bottom and Y_hier match</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="p">[</span><span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">n_years</span><span class="p">:],</span> <span class="n">Y_base</span><span class="p">[</span><span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">n_years</span><span class="p">:]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span>
                <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;base&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="p">[</span><span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">n_years</span><span class="p">:],</span> <span class="n">Y_base2</span><span class="p">[</span><span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">n_years</span><span class="p">:]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span>
                <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;base&#39;</span><span class="p">)</span>
    
    <span class="n">axs</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">Tourist Visits</span><span class="se">\n</span><span class="s1"> [In millions]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Hierarchically Linked Series for </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_file</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
<span class="n">b_idx</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">plot_hierarchically_linked_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">b_idx</span><span class="o">=</span><span class="n">b_idx</span><span class="p">,</span> <span class="n">n_years</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">plot_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Checking-Geographically-linked-data">Checking Geographically linked data<a class="anchor-link" href="#Checking-Geographically-linked-data"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">plot_region_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">region_idx</span><span class="p">,</span> <span class="n">plot_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">x_plot</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">12</span><span class="p">]</span>
    <span class="n">Y_agg</span>  <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y_agg&#39;</span><span class="p">][</span><span class="n">region_idx</span><span class="p">]</span> <span class="c1"># [country,state,zone,region]</span>
    <span class="n">Y_base</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">][</span><span class="n">region_idx</span><span class="p">]</span>
    
    <span class="n">hier_idxs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;hier_linked_idxs&#39;</span><span class="p">][</span><span class="n">region_idx</span><span class="p">]</span>
    <span class="n">Y_agg_labels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;hier_labels&#39;</span><span class="p">][</span><span class="n">hier_idxs</span><span class="p">]</span>
    <span class="n">region</span> <span class="o">=</span> <span class="n">Y_agg_labels</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="c1">#[country,state,zone,region,country_p,state_p,...]</span>
    
    <span class="n">n_years</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">purpose</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;Hol&#39;</span><span class="p">,</span> <span class="s1">&#39;Vis&#39;</span><span class="p">,</span> <span class="s1">&#39;Bus&#39;</span><span class="p">,</span> <span class="s1">&#39;Oth&#39;</span><span class="p">]):</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="p">[</span><span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">n_years</span><span class="p">:],</span> <span class="n">Y_base</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">n_years</span><span class="p">:]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> 
                      <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1">#axs[idx].set_xlabel(&#39;Month&#39;, fontsize=13)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">region</span><span class="si">}{</span><span class="n">purpose</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1"> Tourist Visits</span><span class="se">\n</span><span class="s1"> (In millions)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">idx</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>  
    
    <span class="n">axs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="p">[</span><span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">n_years</span><span class="p">:],</span> <span class="n">Y_base</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">n_years</span><span class="p">:]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> 
                  <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Purpose Grouped Series for </span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_file</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
<span class="n">plot_region_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">region_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name="cell-4"></a></p>
<h2 id="4.-HierTimeseriesDataset-Class">4. HierTimeseriesDataset Class<a class="anchor-link" href="#4.-HierTimeseriesDataset-Class"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="HierTimeseriesDataset" class="doc_header"><code>class</code> <code>HierTimeseriesDataset</code><a href="https://github.com/Nixtla/neuralforecast/tree/main/neuralforecast/data/datasets/tourismL.py#L486" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>HierTimeseriesDataset</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwds</code></strong>) :: <code>Dataset</code></p>
</blockquote>
<p>An abstract class representing a :class:<code>Dataset</code>.</p>
<p>All datasets that represent a map from keys to data samples should subclass
it. All subclasses should overwrite :meth:<code>__getitem__</code>, supporting fetching a
data sample for a given key. Subclasses could also optionally overwrite
:meth:<code>__len__</code>, which is expected to return the size of the dataset by many
:class:<code>~torch.utils.data.Sampler</code> implementations and the default options
of :class:<code>~torch.utils.data.DataLoader</code>.</p>
<p>.. note::
  :class:<code>~torch.utils.data.DataLoader</code> by default constructs a index
  sampler that yields integral indices.  To make it work with a map-style
  dataset with non-integral indices/keys, a custom sampler must be provided.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name="cell-5"></a></p>
<h2 id="5.-HierTimeseriesDataset-Validation">5. HierTimeseriesDataset Validation<a class="anchor-link" href="#5.-HierTimeseriesDataset-Validation"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># directory = &#39;./data/hierarchical/TourismL&#39;</span>
<span class="c1"># TourismL.preprocess_data(directory=directory, verbose=False)</span>
<span class="c1"># data = TourismL.load_process(directory=directory, verbose=False)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="mi">228</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span>
<span class="n">H</span> <span class="o">=</span> <span class="mi">12</span>

<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">HierTimeseriesDataset</span><span class="p">(</span><span class="c1"># Bottom data</span>
                                      <span class="n">X</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> 
                                      <span class="n">S</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> 
                                      <span class="n">Y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span>
                                      <span class="n">xcols</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;xcols&#39;</span><span class="p">],</span>
                                      <span class="n">xcols_hist</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;xcols_hist&#39;</span><span class="p">],</span>
                                      <span class="n">xcols_futr</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;xcols_futr&#39;</span><span class="p">],</span>
                                      <span class="n">xcols_sample_mask</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;xcols_sample_mask&#39;</span><span class="p">],</span>
                                      <span class="n">xcols_available_mask</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;xcols_available_mask&#39;</span><span class="p">],</span>
                                      <span class="n">dates</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">],</span>
                                      <span class="c1"># Aggregated data</span>
                                      <span class="n">X_agg</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;X_agg&#39;</span><span class="p">],</span> 
                                      <span class="n">S_agg</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;S_agg&#39;</span><span class="p">],</span> 
                                      <span class="n">Y_agg</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y_agg&#39;</span><span class="p">],</span>
                                      <span class="n">xcols_agg</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;xcols_agg&#39;</span><span class="p">],</span>
                                      <span class="n">xcols_hist_agg</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;xcols_hist_agg&#39;</span><span class="p">],</span>
                                      <span class="n">xcols_futr_agg</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;xcols_futr_agg&#39;</span><span class="p">],</span>
                                      <span class="c1"># Generator parameters</span>
                                      <span class="n">T0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="p">)</span>

<span class="n">valid_dataset</span> <span class="o">=</span> <span class="n">HierTimeseriesDataset</span><span class="p">(</span><span class="c1"># Bottom data</span>
                                      <span class="n">X</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> 
                                      <span class="n">S</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">],</span> 
                                      <span class="n">Y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span>
                                      <span class="n">xcols</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;xcols&#39;</span><span class="p">],</span>
                                      <span class="n">xcols_hist</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;xcols_hist&#39;</span><span class="p">],</span>
                                      <span class="n">xcols_futr</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;xcols_futr&#39;</span><span class="p">],</span>
                                      <span class="n">xcols_sample_mask</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;xcols_sample_mask&#39;</span><span class="p">],</span>
                                      <span class="n">xcols_available_mask</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;xcols_available_mask&#39;</span><span class="p">],</span> 
                                      <span class="n">dates</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">],</span>
                                      <span class="c1"># Aggregated data</span>
                                      <span class="n">X_agg</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;X_agg&#39;</span><span class="p">],</span> 
                                      <span class="n">S_agg</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;S_agg&#39;</span><span class="p">],</span> 
                                      <span class="n">Y_agg</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y_agg&#39;</span><span class="p">],</span>
                                      <span class="n">xcols_agg</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;xcols_agg&#39;</span><span class="p">],</span>
                                      <span class="n">xcols_hist_agg</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;xcols_hist_agg&#39;</span><span class="p">],</span>
                                      <span class="n">xcols_futr_agg</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;xcols_futr_agg&#39;</span><span class="p">],</span>
                                      <span class="c1"># Generator parameters</span>
                                      <span class="n">T0</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="p">,</span>
                                      <span class="n">lastwindow_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">train_dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">valid_dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">valid_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">train_batch</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">train_dataloader</span><span class="p">))</span>
<span class="n">valid_batch</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">valid_dataloader</span><span class="p">))</span>

<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">train_batch</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">.shape&#39;</span><span class="p">,</span> <span class="n">train_batch</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="5.1-Examinate-HierTimeSeriesDataset-aggregate-batch">5.1 Examinate HierTimeSeriesDataset aggregate batch<a class="anchor-link" href="#5.1-Examinate-HierTimeSeriesDataset-aggregate-batch"> </a></h3><ol>
<li>Examinate the hierarchically linked Y_agg series.</li>
<li>Examinate the alignment between Y_agg and X_agg_futr.</li>
<li>Validate the S_agg dummies generated from H constraints matrix.</li>
</ol>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">batch</span> <span class="o">=</span> <span class="n">valid_batch</span>
<span class="n">S_agg</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;S_agg&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Y_agg</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;Y_agg&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">X_agg</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;X_agg&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">F_agg</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;F_agg&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="c1">#---------------- Hierarchical Y_agg ----------------#</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Y_agg</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Y_agg</span><span class="p">[</span><span class="mi">1</span><span class="p">,:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Y_agg</span><span class="p">[</span><span class="mi">2</span><span class="p">,:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Y_agg</span><span class="p">[</span><span class="mi">3</span><span class="p">,:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Y_agg&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1">#---------------- X_agg_futr ----------------#</span>
<span class="n">F_agg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">F_agg</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">*</span><span class="mi">80000</span><span class="p">,</span>
                   <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">F_agg</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">F_agg</span><span class="p">[</span><span class="o">-</span><span class="mi">36</span><span class="p">:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Y_agg</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">36</span><span class="p">:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;F_agg&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1">#---------------- S_agg ----------------#</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">spy</span><span class="p">(</span><span class="n">S_agg</span><span class="p">[</span><span class="kc">None</span><span class="p">,:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;S_agg&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="5.2-Examinate-HierTimeSeriesDataset-bottom-batch">5.2 Examinate HierTimeSeriesDataset bottom batch<a class="anchor-link" href="#5.2-Examinate-HierTimeSeriesDataset-bottom-batch"> </a></h3><ol>
<li>Examinate the alignment between Y_bottom, S_bottom and X_bottom_futr.</li>
<li>Validate batch Seq2Seq structure between X_bottom vs Y_bottom.</li>
</ol>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># batch = train_batch</span>
<span class="c1"># dates = train_dataset.dates</span>
<span class="n">batch</span> <span class="o">=</span> <span class="n">valid_batch</span>
<span class="n">dates</span> <span class="o">=</span> <span class="n">valid_dataset</span><span class="o">.</span><span class="n">dates</span>
<span class="n">S_bottom</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Y_bottom</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">X_bottom</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">F_bottom</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">sample_mask</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;sample_mask&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="c1">#---------------- Y/S/X_bottom alignment ----------------#</span>
<span class="n">n_years</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">purpose</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;Hol&#39;</span><span class="p">,</span> <span class="s1">&#39;Vis&#39;</span><span class="p">,</span> <span class="s1">&#39;Bus&#39;</span><span class="p">,</span> <span class="s1">&#39;Oth&#39;</span><span class="p">]):</span>    
    <span class="n">axs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">n_years</span><span class="o">*</span><span class="mi">12</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">Y_bottom</span><span class="p">[</span><span class="n">idx</span><span class="p">,:</span><span class="n">n_years</span><span class="o">*</span><span class="mi">12</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">S_bottom</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">S_bottom</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">S_bottom</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> 
                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;level_[december]&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">S_bottom</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">S_bottom</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span>
                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;level_[january]&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    
    <span class="n">axs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">n_years</span><span class="o">*</span><span class="mi">12</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span>
                  <span class="n">F_bottom</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">0</span><span class="p">,:</span><span class="n">n_years</span><span class="o">*</span><span class="mi">12</span><span class="p">]</span><span class="o">*</span><span class="n">S_bottom</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">S_bottom</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
                 <span class="n">label</span><span class="o">=</span><span class="s1">&#39;dummy_[december]&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">n_years</span><span class="o">*</span><span class="mi">12</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span>
                  <span class="n">F_bottom</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">1</span><span class="p">,:</span><span class="n">n_years</span><span class="o">*</span><span class="mi">12</span><span class="p">]</span><span class="o">*</span><span class="n">S_bottom</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">S_bottom</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span>
                 <span class="n">label</span><span class="o">=</span><span class="s1">&#39;dummy_[january]&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">purpose</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Y/S/X/F_bottom alignment &#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.91</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1">#---------------- Y/X_bottom Seq2Seq structure ----------------#</span>
<span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">start</span> <span class="o">=</span> <span class="mi">155</span>
<span class="n">end</span> <span class="o">=</span> <span class="mi">203</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">],</span>     <span class="n">Y_bottom</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">+</span><span class="mi">100</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="n">start</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">end</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_bottom</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;y_[lag1]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="o">+</span><span class="mi">12</span><span class="p">],</span>  <span class="n">F_bottom</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="o">+</span><span class="mi">12</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;y_[lag12]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">],</span>     <span class="n">sample_mask</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">*</span><span class="n">Y_bottom</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;sample_mask&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Tourist Visits</span><span class="se">\n</span><span class="s1"> [In millions]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Y/X_bottom (Seq2Seq)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

