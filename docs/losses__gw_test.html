---

title: Giacomini-White Test


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/losses__gw_test.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/losses__gw_test.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Giacomini-White-Conditional-Predictive-Ability-Test">Giacomini-White Conditional Predictive Ability Test<a class="anchor-link" href="#Giacomini-White-Conditional-Predictive-Ability-Test"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="GW_CPA_test" class="doc_header"><code>GW_CPA_test</code><a href="https://github.com/Nixtla/neuralforecast/tree/main/neuralforecast/losses/gw_test.py#L63" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>GW_CPA_test</code>(<strong><code>loss1</code></strong>:<code>ndarray</code>, <strong><code>loss2</code></strong>:<code>ndarray</code>, <strong><code>tau</code></strong>:<code>int</code>, <strong><code>alpha</code></strong>:<code>float</code>=<em><code>0.05</code></em>, <strong><code>conditional</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>verbose</code></strong>:<code>bool</code>=<em><code>True</code></em>)</p>
</blockquote>
<p>The one-sided Giacomini-White Conditional Predictive Ability Test (GW),
allows to assess which model provides better predictions.</p>
<p>The GW test examines the null hypothesis of equal forecast errors
for a pair of models's predictions $\hat{\mathbf{y}}^{A}_{\tau}$ and
$\hat{\mathbf{y}}^{B}_{\tau}$ measured by the MAE or L1 norm,
conditioned on the available information to that moment $\mathcal{F}_{\tau-1}$.</p>
$$ \Delta^{A,B}_{\tau} = ||\mathbf{y}_{\tau} - \hat{\mathbf{y}}^{A}_{\tau}||_{1}
    - ||\mathbf{y}_{\tau} - \hat{\mathbf{y}}^{B}_{\tau}||_{1} $$<p>In practice, the $ \mathcal{F}_{\tau-1} $ is replaced with a constant and
lags of the error difference
$ \mathcal{F}_{\tau-1} = [\mathbb{1} \;|\; \Delta^{A,B}_{\tau - 1} ] $
and the test is performed using a linear regression with a Wald-like test.</p>
$$ \Delta^{A,B}_{\tau} =
   \boldsymbol{\beta}^{\intercal} \mathcal{F}_{\tau-1} + \epsilon_{\tau} $$$$ H_{0}: \mathbb{E} \left[ \Delta^{A,B}_{\tau} \;|\; \mathcal{F}_{\tau-1} \right]
   \equiv \mathbb{E} \left[ \boldsymbol{\beta} \;|\; \mathcal{F}_{\tau-1} \right] = \mathbb{0}  $$<p>The Diebold-Mariano test widely used in the forecasting literature,
can be easily recovered by setting, when the conditional information considered
is only the constant variable, one recovers the original DB test.
Compared with the DM or other unconditional tests,
the GW test is valid under general assumptions such as heterogeneity
rather than stationarity of data.</p>

<pre><code>Parameters
----------
loss1:
    numpy array. losses of model 1
loss2:
    numpy array. losses of model 2
tau: int
    the past information treated as 'available' for the test.
alpha: float
    level of significance for the test.
conditional: boolean.
    True if conditional (DM test), False if unconditional (GW test).
verbose: boolean.
    True if prints of test are needed.

Returns
-------
test_stat: test statistic of the conditional predictive ability test
crit_val: critical value of the chi-square test for a 5% confidence level
p-vals: (k,) p-value of the test

References
----------
[1] Giacomini, R., &amp; White, H., Tests of conditional predictive ability. Econometrica, 74
URL: https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1468-0262.2006.00718.

[2] Diebold, F., &amp; Mariano, R. (2002). Comparing predictive accuracy.
Journal of Business &amp; Economic Statistics, 20 , 134â€“44.
URL: https://www.sas.upenn.edu/~fdiebold/papers/paper68/pa.dm.pdf.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Giacomini-White-Conditional-p-values">Giacomini-White Conditional p-values<a class="anchor-link" href="#Giacomini-White-Conditional-p-values"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_GW_test_pvals" class="doc_header"><code>get_GW_test_pvals</code><a href="https://github.com/Nixtla/neuralforecast/tree/main/neuralforecast/losses/gw_test.py#L184" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_GW_test_pvals</code>(<strong><code>y</code></strong>:<code>ndarray</code>, <strong><code>y_hat</code></strong>:<code>ndarray</code>, <strong><code>horizon</code></strong>:<code>int</code>, <strong><code>tau</code></strong>:<code>int</code>, <strong><code>conditional</code></strong>:<code>bool</code>, <strong><code>alpha</code></strong>:<code>float</code>=<em><code>0.05</code></em>, <strong><code>verbose</code></strong>:<code>bool</code>=<em><code>False</code></em>)</p>
</blockquote>
<p>Function to calculate model-pair-wise GW-Test p-values.</p>

<pre><code>Parameters
----------
y: numpy array
    flat array with actual test values
y_hat: numpy array
    matrix with predicted values
horizon: int
    the multi horizon for which the predictions were created,
    the test is performed against over the mean differences
    in said multi horizon losses.
tau: int
    the past information treated as 'available' for the test.
conditional: boolean,
    True if conditional (DM test), False if unconditional (GW test).
alpha: float
    level of significance for the test.
verbose: boolean.
    True for partial test results.

Returns
-------
p_vals: (n_models, n_models)
        symmetric numpy array with the model-pair-wise p-values.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="plot_GW_test_pvals" class="doc_header"><code>plot_GW_test_pvals</code><a href="https://github.com/Nixtla/neuralforecast/tree/main/neuralforecast/losses/gw_test.py#L281" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>plot_GW_test_pvals</code>(<strong><code>pvals</code></strong>:<code>ndarray</code>, <strong><code>labels</code></strong>:<code>List</code>[<code>str</code>], <strong><code>title</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Function to plot model-pair-wise GW-Test p-values.</p>

<pre><code>Parameters
----------
p_vals: (n_models, n_models)
    symmetric numpy array with the model-pair-wise p-values.
labels: string list
    list of model names
title: string
    title of the plot</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Examples">Examples<a class="anchor-link" href="#Examples"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.-GW-with-ModelB-prefered-to-ModelA.">1. GW with ModelB prefered to ModelA.<a class="anchor-link" href="#1.-GW-with-ModelB-prefered-to-ModelA."> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lossA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">lossB</span> <span class="o">=</span> <span class="n">lossA</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">-</span> <span class="n">lossA</span><span class="o">/</span><span class="mi">10</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lossA</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Model A&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#78ACA8&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lossB</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Model B&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#E3A39A&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Errors&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">test_stat</span><span class="p">,</span> <span class="n">crit_val</span><span class="p">,</span> <span class="n">p_val</span> <span class="o">=</span> <span class="n">GW_CPA_test</span><span class="p">(</span><span class="n">loss1</span><span class="o">=</span><span class="n">lossA</span><span class="p">,</span> <span class="n">loss2</span><span class="o">=</span><span class="n">lossB</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">conditional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="2.-GW-with-ModelA-prefered-to-ModelB.">2. GW with ModelA prefered to ModelB.<a class="anchor-link" href="#2.-GW-with-ModelA-prefered-to-ModelB."> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lossA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">lossB</span> <span class="o">=</span> <span class="n">lossA</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">+</span> <span class="n">lossA</span><span class="o">/</span><span class="mi">10</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lossA</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Model A&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#78ACA8&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lossB</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Model B&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#E3A39A&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Errors&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">test_stat</span><span class="p">,</span> <span class="n">crit_val</span><span class="p">,</span> <span class="n">p_val</span> <span class="o">=</span> <span class="n">GW_CPA_test</span><span class="p">(</span><span class="n">loss1</span><span class="o">=</span><span class="n">lossA</span><span class="p">,</span> <span class="n">loss2</span><span class="o">=</span><span class="n">lossB</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">conditional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="3.-GW-pairwise-models'-comparison">3. GW pairwise models' comparison<a class="anchor-link" href="#3.-GW-pairwise-models'-comparison"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="mi">24</span><span class="p">))</span> 

<span class="c1"># Five different models with augmenting error variance</span>
<span class="n">eps0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="mi">24</span><span class="p">,))</span>
<span class="n">eps1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="mi">24</span><span class="p">,))</span>
<span class="n">eps2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="mi">24</span><span class="p">,))</span>
<span class="n">eps3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="mi">24</span><span class="p">,))</span>
<span class="n">eps4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="mi">24</span><span class="p">,))</span>

<span class="n">y_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span><span class="kc">None</span><span class="p">],</span> <span class="n">repeats</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y_hat</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_hat</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">eps0</span>
<span class="n">y_hat</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_hat</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">eps1</span>
<span class="n">y_hat</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_hat</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">eps2</span>
<span class="n">y_hat</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_hat</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">eps3</span>
<span class="n">y_hat</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_hat</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">eps4</span>

<span class="n">model_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Model1&#39;</span><span class="p">,</span> <span class="s1">&#39;Model2&#39;</span><span class="p">,</span> <span class="s1">&#39;Model3&#39;</span><span class="p">,</span> <span class="s1">&#39;Model4&#39;</span><span class="p">,</span> <span class="s1">&#39;Model5&#39;</span><span class="p">]</span>
<span class="n">pvals</span> <span class="o">=</span> <span class="n">get_GW_test_pvals</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">y_hat</span><span class="o">=</span><span class="n">y_hat</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">conditional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model 1 is prefered over all the other models&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model 5 is non-significantly prefered over Model 4&quot;</span><span class="p">)</span>
<span class="n">plot_GW_test_pvals</span><span class="p">(</span><span class="n">pvals</span><span class="o">=</span><span class="n">pvals</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">model_names</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;GW_test&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

